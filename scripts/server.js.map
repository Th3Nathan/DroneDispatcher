{"version":3,"sources":["webpack:///webpack/bootstrap 570c6d82c9830d355430","webpack:///./scripts/package.js","webpack:///./scripts/drone.js","webpack:///./scripts/main.js","webpack:///./scripts/api_util.js","webpack:///./scripts/location.js","webpack:///external \"request-promise-native\"","webpack:///./scripts/assign.js","webpack:///external \"express\""],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;;;;;;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;;;;;;;;;;;AC/CA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA,CAAC;;;;;;;;;;;;;ACZD;AACA;AACA;AACA;;AAEA;AACA;AACA,6CAA6C,SAAS;AACtD;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;;;;;;;;AC/DA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;;;;;ACjCA,mD;;;;;;;;;ACAA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,sCAAsC;AAC5D,GAAG;;AAEH;AACA;;AAEA,UAAU;AACV;;AAEA;;;;;;;AC1BA,oC","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 570c6d82c9830d355430","\nclass Package {\n  constructor(attributes){\n    this.destination = attributes.destination;\n    this.startLocation = attributes.startLocation;\n    this.deadline = attributes.deadline;\n    this.id = attributes.id;\n  }\n\n  mustLeaveByUNIX(speed){\n    return this.deadline - this.destination.secondsTo(this.startLocation, speed);\n  }\n}\n\nPackage.prototype.compareFartherFirst = function(packageA, packageB){\n  return packageA.mustLeaveByUNIX() - packageB.mustLeaveByUNIX();\n};\n\nPackage.prototype.sortNeedLeaveSooner = function(packages){\n  return packages.sort(this.compareFartherFirst);\n};\n\nexport default Package;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./scripts/package.js\n// module id = 0\n// module chunks = 0","\nclass Drone {\n  constructor(attributes){\n    this.currentLocation = attributes.currentLocation;\n    this.homeLocation = attributes.homeLocation;\n    this.packages = attributes.packages;\n    this.id = attributes.id;\n  }\n\n  timeTillHome(){\n    return this.currentLocation.secondsTo(this.homeLocation);\n  }\n\n  noPackages(){\n    return this.packages.length === 0;\n  }\n\n  cannotDeliver(pack){\n    const currentTime = new Date().getTime() / 1000 | 0;\n    return (pack.deadline - this.timeTillAvailable()) < currentTime;\n  }\n\n  packageDeliverTime(){\n    return this.packages.reduce(\n      (time, pack) => {\n        const toDestination = this.currentLocation.secondsTo(pack.destination);\n        const toHome = pack.destination.secondsTo(this.homeLocation);\n        this.currentLocation = this.homeLocation;\n        return time + toDestination + toHome;\n      },\n      0\n    );\n  }\n\n  timeTillAvailable(){\n    return this.noPackages() ? this.timeTillHome() : this.packageDeliverTime();\n  }\n}\n\nDrone.prototype.compareTimeTillAvailable = function(droneA, droneB){\n    return droneA.timeTillAvailable() - droneB.timeTillAvailable();\n  };\n\nDrone.prototype.sortTimeAvailable = function(drones){\n  return drones.sort(this.compareTimeTillAvailable);\n};\n\nexport default Drone;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./scripts/drone.js\n// module id = 1\n// module chunks = 0","import getData from './api_util';\nimport assign from './assign';\nimport express from 'express';\nconst app = express();\n\napp.get('/assignments', function (req, res) {\n  getData().then(items => res.send(assign(items)))\n    .catch(() => res.send(\"Error\"));\n});\n\napp.listen(3000, function () {\n  console.log('Listening on port 3000!');\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./scripts/main.js\n// module id = 2\n// module chunks = 0","import Package from './package';\nimport Drone from './drone';\nimport Location from './location';\nimport rp from 'request-promise-native';\n\nconst options = (endpoint) => {\n  return {\n    uri: `http://codetest.kube.getswift.co/${endpoint}`,\n    headers: {\n        'User-Agent': 'Request-Promise'\n    },\n    json: true\n  };\n};\n\nconst fetch = (items) => rp(options(items));\n\nconst formatPackage = (data) => {\n  let destination = new Location(data.destination.latitude, data.destination.longitude);\n  let startLocation = new Location(-37.816656, 144.964212);\n  let id = data.packageId;\n  let deadline = data.deadline;\n  return new Package({\n    id,\n    destination,\n    startLocation,\n    deadline\n  });\n};\n\nconst formatDrone = (data) => {\n  let id = data.droneId;\n  let currentLocation = new Location(data.location.latitude, data.location.longitude);\n  let homeLocation = new Location(-37.816656, 144.964212);\n  let packages = formatPackages(data.packages);\n  return new Drone({\n    id,\n    currentLocation,\n    homeLocation,\n    packages\n  });\n};\n\nconst formatPackages = (packagesData) => {\n  return packagesData.map(data => formatPackage(data));\n};\n\nconst formatDrones = (dronesData) => {\n  return dronesData.map(data => formatDrone(data));\n};\n\nconst getData = () => {\n  return Promise.all([fetch(\"packages\"), fetch(\"drones\")])\n  .then(values => {\n    let packages = formatPackages(values[0]);\n    let drones = formatDrones(values[1]);\n    return {\n      packages,\n      drones\n    };\n  });\n};\n\nexport default getData;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./scripts/api_util.js\n// module id = 3\n// module chunks = 0","class Location {\n  constructor(latitude, longitude){\n    this.latitude = latitude;\n    this.longitude = longitude;\n  }\n\n  distance(loc2){\n    // http://www.movable-type.co.uk/scripts/latlong.html\n    // In kilometers\n    const R = 6371e3; // metres\n    const φ1 = this._latRadians();\n    const φ2 = loc2._latRadians();\n    const Δφ = (loc2.latitude - this.latitude) * Math.PI / 180;\n    const Δλ = (loc2.longitude - this.longitude) * Math.PI / 180;\n\n    const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +\n    Math.cos(φ1) * Math.cos(φ2) *\n    Math.sin(Δλ/2) * Math.sin(Δλ/2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n    return (R * c) / 1000;\n  }\n\n  secondsTo(loc2, speed){\n    // speed in kilometers/hour\n    speed |= 50;\n    return (this.distance(loc2) / speed) * 3600;\n  }\n\n  _latRadians(){\n    return this.latitude * Math.PI / 180;\n  }\n}\n\nexport default Location;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./scripts/location.js\n// module id = 4\n// module chunks = 0","module.exports = require(\"request-promise-native\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"request-promise-native\"\n// module id = 5\n// module chunks = 0","import Drone from './drone';\nimport Package from './package';\n\nconst assign = (items) => {\n  const orderedDrones = Drone.prototype.sortTimeAvailable(items.drones);\n  const orderedPackages = Package.prototype.sortNeedLeaveSooner(items.packages);\n  const unassignedPackageIds = [];\n  const assignments = [];\n\n  orderedDrones.forEach(drone => {\n    let pack = orderedPackages.shift();\n    if (!pack) return;\n    while (drone.cannotDeliver(pack)){\n      unassignedPackageIds.push(pack.id);\n      pack = orderedPackages.shift();\n      if (!pack) return;\n    }\n    assignments.push({droneID: drone.id, packageID: pack.id});\n  });\n\n  const leftoverPackIDS = orderedPackages.map(pack => pack.id);\n  leftoverPackIDS.forEach(id => unassignedPackageIds.push(id));\n\n  return { assignments, unassignedPackageIds };\n};\n\nexport default assign;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./scripts/assign.js\n// module id = 6\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 7\n// module chunks = 0"],"sourceRoot":""}